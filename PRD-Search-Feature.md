# ğŸ” í†µí•© ê²€ìƒ‰ ê¸°ëŠ¥ PRD (Product Requirements Document)

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

### ëª©í‘œ
ì‚¬ìš©ìê°€ ê²Œì‹œíŒ, ë‰´ìŠ¤, íŒ€ ì •ë³´ë¥¼ í†µí•©ì ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ êµ¬í˜„

### í•µì‹¬ ê°€ì¹˜
- **í†µí•©ì„±**: ëª¨ë“  ì½˜í…ì¸ ë¥¼ í•œ ë²ˆì— ê²€ìƒ‰
- **ì •í™•ì„±**: Supabase Full-Text Search í™œìš©í•œ ê³ í’ˆì§ˆ ê²€ìƒ‰
- **ì†ë„**: ì¸ë±ìŠ¤ ê¸°ë°˜ ë¹ ë¥¸ ê²€ìƒ‰ ì‘ë‹µ

---

## ğŸ¯ MVP ë²”ìœ„ (1ë‹¨ê³„)

### ê¸°ëŠ¥ ë²”ìœ„
- [x] `/search` ë¼ìš°íŠ¸ ìƒì„±
- [x] `searchPosts()` í•¨ìˆ˜ êµ¬í˜„ (ê²Œì‹œê¸€ ê²€ìƒ‰ë§Œ)
- [x] ê¸°ë³¸ ê²€ìƒ‰ UI êµ¬í˜„
- [x] ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ

### ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: Supabase PostgreSQL Full-Text Search
- **Frontend**: Next.js App Router + Server Actions
- **Database**: `to_tsvector()`, `to_tsquery()`, GIN ì¸ë±ìŠ¤

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ê²€ìƒ‰ ëŒ€ìƒ í…Œì´ë¸”
```sql
-- 1ë‹¨ê³„: posts í…Œì´ë¸”ë§Œ
posts {
  id: string
  title: string
  content: Json
  board_id: string
  user_id: string
  created_at: string
  views: number
  likes: number
}

-- ê´€ë ¨ í…Œì´ë¸”
boards { id, name, slug }
profiles { id, nickname, icon_id }
```

### Full-Text Search ì¸ë±ìŠ¤ ìƒì„±
```sql
-- posts í…Œì´ë¸”ì— fts ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE posts 
ADD COLUMN fts tsvector 
GENERATED ALWAYS AS (
  to_tsvector('korean', title || ' ' || COALESCE(content::text, ''))
) STORED;

-- GIN ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX posts_fts_idx ON posts USING gin(fts);
```

---

## ğŸ› ï¸ ê¸°ìˆ  êµ¬í˜„

### í´ë” êµ¬ì¡°
```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ search/
â”‚       â””â”€â”€ page.tsx              # /search ë¼ìš°íŠ¸
â”œâ”€â”€ domains/
â”‚   â””â”€â”€ search/
â”‚       â”œâ”€â”€ actions.ts            # searchPosts() ì„œë²„ ì•¡ì…˜
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ SearchBar.tsx     # ê²€ìƒ‰ì°½
â”‚       â”‚   â””â”€â”€ SearchResults.tsx # ê²€ìƒ‰ ê²°ê³¼
â”‚       â””â”€â”€ types/
â”‚           â””â”€â”€ index.ts          # ê²€ìƒ‰ íƒ€ì… ì •ì˜
```

### í•µì‹¬ í•¨ìˆ˜: searchPosts()
```typescript
// src/domains/search/actions.ts
'use server'

export async function searchPosts(query: string) {
  const supabase = createServerComponentClient()
  
  const { data, error } = await supabase
    .from('posts')
    .select(`
      id, title, content, created_at, views, likes, post_number,
      profiles(nickname, icon_id),
      boards(name, slug)
    `)
    .match({ is_published: true })
    .textSearch('fts', query)
    .order('created_at', { ascending: false })
    .limit(20)
    
  if (error) throw error
  return data
}
```

---

## ğŸ¨ UI/UX ì„¤ê³„

### ê²€ìƒ‰ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ
```
/search?q=ë¦¬ë²„í’€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” [ê²€ìƒ‰ì°½: "ë¦¬ë²„í’€"]    [ê²€ìƒ‰ ë²„íŠ¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š "ë¦¬ë²„í’€" ê²€ìƒ‰ ê²°ê³¼ (ì´ 12ê°œ)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ ê²Œì‹œê¸€ (12ê°œ)                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ† ë¦¬ë²„í’€ vs ë§¨ì‹œí‹° ê²½ê¸° í›„ê¸°      â”‚ â”‚
â”‚ â”‚ ğŸ‘¤ ì¶•êµ¬íŒ¬123 â€¢ ììœ ê²Œì‹œíŒ         â”‚ â”‚
â”‚ â”‚ ğŸ“… 2024-01-15 â€¢ ğŸ‘€ 245 â€¢ ğŸ‘ 12  â”‚ â”‚
â”‚ â”‚ ğŸ’¬ "ë¦¬ë²„í’€ì´ ì •ë§ ì˜í–ˆë‹¤..."       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš½ ë¦¬ë²„í’€ ì´ì  ë£¨ë¨¸ ì •ë¦¬           â”‚ â”‚
â”‚ â”‚ ğŸ‘¤ ìŠ¤í¬ì¸ ê¸°ì â€¢ ì´ì ë‰´ìŠ¤          â”‚ â”‚
â”‚ â”‚ ğŸ“… 2024-01-14 â€¢ ğŸ‘€ 189 â€¢ ğŸ‘ 8   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê²€ìƒ‰ ê²°ê³¼ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
```tsx
interface SearchResultCard {
  title: string           // ê²Œì‹œê¸€ ì œëª©
  author: string         // ì‘ì„±ì ë‹‰ë„¤ì„
  boardName: string      // ê²Œì‹œíŒ ì´ë¦„
  createdAt: string      // ì‘ì„±ì¼
  views: number          // ì¡°íšŒìˆ˜
  likes: number          // ì¢‹ì•„ìš”
  snippet: string        // ê²€ìƒ‰ì–´ í¬í•¨ ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°
  url: string           // ê²Œì‹œê¸€ ë§í¬
}
```

---

## ğŸš€ êµ¬í˜„ ë‹¨ê³„

### Phase 1: MVP (1ì£¼ì°¨)
- [x] `/search` í˜ì´ì§€ ìƒì„±
- [x] `searchPosts()` ì„œë²„ ì•¡ì…˜ êµ¬í˜„
- [x] ê¸°ë³¸ ê²€ìƒ‰ì°½ UI
- [x] ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
- [x] ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìƒì„±

### Phase 2: í™•ì¥ (2ì£¼ì°¨)
- [ ] ëŒ“ê¸€ ê²€ìƒ‰ ì¶”ê°€ (`searchComments()`)
- [ ] ë‰´ìŠ¤ ê²€ìƒ‰ ì¶”ê°€ (`searchNews()`)
- [ ] íŒ€ ê²€ìƒ‰ ì¶”ê°€ (`searchTeams()`)
- [ ] í†µí•© ê²€ìƒ‰ ê²°ê³¼ íƒ­

### Phase 3: ê³ ë„í™” (3ì£¼ì°¨)
- [ ] ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŠ¸
- [ ] ìë™ì™„ì„± ê¸°ëŠ¥
- [ ] ê²€ìƒ‰ í•„í„° (ë‚ ì§œ, ê²Œì‹œíŒë³„)
- [ ] ë¬´í•œ ìŠ¤í¬ë¡¤

---

## ğŸ“Š ì„±ê³µ ì§€í‘œ

### ê¸°ìˆ ì  ì§€í‘œ
- ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„: < 500ms
- ê²€ìƒ‰ ì •í™•ë„: ê´€ë ¨ì„± ë†’ì€ ê²°ê³¼ ìƒìœ„ ë…¸ì¶œ
- ì¸ë±ìŠ¤ í¬ê¸°: ìµœì í™”ëœ ì €ì¥ ê³µê°„

### ì‚¬ìš©ì ì§€í‘œ
- ê²€ìƒ‰ ì‚¬ìš©ë¥ : ì¼ í™œì„± ì‚¬ìš©ì ëŒ€ë¹„ ê²€ìƒ‰ ì‚¬ìš© ë¹„ìœ¨
- ê²€ìƒ‰ ì„±ê³µë¥ : ê²€ìƒ‰ í›„ ê²°ê³¼ í´ë¦­ ë¹„ìœ¨
- ì¬ê²€ìƒ‰ë¥ : ì²« ê²€ìƒ‰ í›„ ì¬ê²€ìƒ‰í•˜ëŠ” ë¹„ìœ¨

---

## ğŸ”§ ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

### Supabase Full-Text Search í™œìš©
- **í•œêµ­ì–´ ì§€ì›**: `to_tsvector('korean', text)` ì‚¬ìš©
- **ë¶€ë¶„ ê²€ìƒ‰**: `query:*` ë¬¸ë²•ìœ¼ë¡œ prefix ê²€ìƒ‰
- **ë³µí•© ê²€ìƒ‰**: `&` (AND), `|` (OR) ì—°ì‚°ì í™œìš©
- **ê·¼ì ‘ ê²€ìƒ‰**: `<->` ì—°ì‚°ìë¡œ ë‹¨ì–´ ê°„ ê±°ë¦¬ ê²€ìƒ‰

### ì„±ëŠ¥ ìµœì í™”
- GIN ì¸ë±ìŠ¤ë¡œ ë¹ ë¥¸ Full-Text Search
- ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ë„¤ì´ì…˜ (20ê°œì”©)
- ê²€ìƒ‰ì–´ ìºì‹± (ì¸ê¸° ê²€ìƒ‰ì–´)

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- SQL Injection ë°©ì§€ (Supabase ìë™ ì²˜ë¦¬)
- ë¹„ê³µê°œ ê²Œì‹œê¸€ ì œì™¸ (`is_published: true`)
- ì‚¬ìš©ì ê¶Œí•œ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ í•„í„°ë§

---

## ğŸ“ ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤
- [ ] posts í…Œì´ë¸” fts ì»¬ëŸ¼ ì¶”ê°€
- [ ] GIN ì¸ë±ìŠ¤ ìƒì„±
- [ ] ê²€ìƒ‰ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

### ë°±ì—”ë“œ
- [ ] `searchPosts()` ì„œë²„ ì•¡ì…˜ êµ¬í˜„
- [ ] ê²€ìƒ‰ ê²°ê³¼ íƒ€ì… ì •ì˜
- [ ] ì—ëŸ¬ í•¸ë“¤ë§

### í”„ë¡ íŠ¸ì—”ë“œ
- [ ] `/search` í˜ì´ì§€ ìƒì„±
- [ ] SearchBar ì»´í¬ë„ŒíŠ¸
- [ ] SearchResults ì»´í¬ë„ŒíŠ¸
- [ ] ë¡œë”© ìƒíƒœ ì²˜ë¦¬
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜•

### í…ŒìŠ¤íŠ¸
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] ê²€ìƒ‰ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

---

## ğŸ¯ ì˜ˆìƒ ê²€ìƒ‰ ì‹œë‚˜ë¦¬ì˜¤

### "ë¦¬ë²„í’€" ê²€ìƒ‰
1. **ì œëª© ë§¤ì¹­**: "ë¦¬ë²„í’€ vs ë§¨ì‹œí‹°"
2. **ë³¸ë¬¸ ë§¤ì¹­**: "ë¦¬ë²„í’€ì´ ì¢‹ì€ ê²½ê¸°ë¥¼ ë³´ì—¬ì¤¬ë‹¤"
3. **ë¶€ë¶„ ë§¤ì¹­**: "ë¦¬ë²„í’€FC", "ë¦¬ë²„í’€íŒ¬"

### "ì±”í”¼ì–¸ìŠ¤ë¦¬ê·¸" ê²€ìƒ‰
1. **ì™„ì „ ë§¤ì¹­**: "ì±”í”¼ì–¸ìŠ¤ë¦¬ê·¸ 16ê°•"
2. **ë¶€ë¶„ ë§¤ì¹­**: "ì±”ìŠ¤", "UCL"
3. **ê´€ë ¨ ë§¤ì¹­**: "ìœ ëŸ½ì¶•êµ¬", "ì±”í”¼ì–¸ìŠ¤"

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Supabase Full-Text Search ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs/guides/database/full-text-search)
- [PostgreSQL Text Search ë¬¸ì„œ](https://www.postgresql.org/docs/current/textsearch.html)
- [Next.js App Router ì„œë²„ ì•¡ì…˜](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024-01-15  
**ë‹´ë‹¹ì**: ê°œë°œíŒ€  
**ìƒíƒœ**: êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ 